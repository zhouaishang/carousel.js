/*
 * Carousel.js 0.0.4
 * Copyright Hito (vip@hitoy.org) All rights reserved
 */
(function(w){'use strict';var version='0.0.4';var readyState=w.document.readyState;var carousels;if(readyState==="interactive"||readyState==="complete"){init();}else{w.document.addEventListener("DOMContentLoaded",init);}
function init(){carousels=w.document.querySelectorAll('[carousel-container]');carousels.forEach(function(carousel){var loop=carousel.hasAttribute('carousel-loop');var autoplay=carousel.hasAttribute('carousel-autoplay');var delay=carousel.hasAttribute('carousel-delay')?parseInt(carousel.getAttribute('carousel-delay')):6000;var duration=carousel.hasAttribute('carousel-duration')?parseInt(carousel.getAttribute('carousel-duration')):600;var step=carousel.hasAttribute('carousel-step')?parseInt(carousel.getAttribute('carousel-step')):'auto';var direction=carousel.hasAttribute('carousel-direction')?['x','y'].indexOf(carousel.getAttribute('carousel-direction'))==-1?'x':carousel.getAttribute('carousel-direction'):'x';var mousewheel=carousel.hasAttribute('carousel-mousewheel');var carouselscroll=carousel.querySelector('[carousel-scroll]');if(!carouselscroll)return;var carouselscrollactiveclass=carouselscroll.getAttribute('carousel-scroll-activeclass')||'visible';carousel.classList.add('carousel-container');carouselscroll.classList.add('carousel-scroll');if(direction==='x')
carouselscroll.classList.add('carousel-scroll-x');else
carouselscroll.classList.add('carousel-scroll-y');var indicator=carousel.querySelector('[carousel-indicator]')
var activeclass=indicator?indicator.getAttribute('carousel-indicator-focusclass')||'carousels-indicator-active':'carousels-indicator-active';var nextbutton=carousel.querySelector('[carousel-next-button]');var previousbutton=carousel.querySelector('[carousel-previous-button]');if(nextbutton){nextbutton.classList.add('carousel-nextbutton');nextbutton.setAttribute('role','button');nextbutton.setAttribute('tabindex','0');}
if(previousbutton){previousbutton.classList.add('carousel-previousbutton');previousbutton.setAttribute('role','button');previousbutton.setAttribute('tabindex','0');}
var carousel=new Carousel(carouselscroll,carouselscrollactiveclass,duration,step,loop,direction,indicator,activeclass,nextbutton,previousbutton,mousewheel);if(autoplay){carousel.autoplay(delay);}});}
function Carousel(carouselscroll,carouselscrollactiveclass,duration,step,loop,direction,indicator,activeclass,nextbutton,previousbutton,mousewheel){var _this=this;var in_transition=false;var eligible=true;var autoplayid;var html=carouselscroll.outerHTML;var carouselwrap;var carouselleft;var carouselright;var carouseltop;var carouselbottom;var carouselwidth;var carouselheight;var scrollY;var scrollX;var scrollwidth;var scrollheight;var slidercount;var slidercountinview;var step=step;var currentindex=0;function get_offset(){if(arguments.length==1){var index=arguments[0];direction=direction;}else if(arguments.length==2){var index=arguments[0];direction=arguments[1];}else{return false;}
var carousel=carouselscroll.children;if(index>carousel.length||index<0)return false;var slider=carousel[index];var rect=slider.getBoundingClientRect();if(direction=='x')
return rect.left-carouselleft-(scrollX-w.scrollX);else
return rect.top-carouseltop-(scrollY-w.scrollY);}
function get_slider_count_in_view(){var containernum=(direction==='x')?carouselwidth:carouselheight;var count=carouselscroll.children.length;for(var i in carouselscroll.children){var slider=carouselscroll.children[i];var rect=slider.getBoundingClientRect();var num=(direction=='x')?rect.right-carouselleft-(scrollX-w.scrollX):rect.bottom-carouseltop-(scrollY-w.scrollY);if(num>containernum){return parseInt(i);}}
return count;}
function is_filled(){var sliders=carouselscroll.children;var slidercount=sliders.length;var lastitem=sliders[slidercount-1];var rect=lastitem.getBoundingClientRect();if(direction=='x')
return rect.right-carouselleft>=carouselwidth;else
return rect.bottom-carouseltop>=carouselheight;}
function move(){if(arguments.length==2){var index=arguments[0];var duration=arguments[1];direction=direction;}else if(arguments.length==3){var index=arguments[0];var duration=arguments[1];direction=arguments[2];}else{return false;}
var offset=get_offset(index);var transdis=parseFloat(carouselscroll.getAttribute('data-translate'))-offset;carouselscroll.style.transitionDuration=parseFloat(duration/1000)+'s';if(direction=='x')
carouselscroll.style.transform='translateX('+transdis+'px)';else
carouselscroll.style.transform='translateY('+transdis+'px)';carouselscroll.setAttribute('data-translate',transdis);currentindex=index;}
function __init(){scrollY=w.scrollY;scrollX=w.scrollX;if(!carouselwrap){carouselwrap=document.createElement('div');carouselwrap.className='carousel-wrap';carouselscroll.parentNode.insertBefore(carouselwrap,carouselscroll);carouselwrap.appendChild(carouselscroll);}
var rect=carouselscroll.getBoundingClientRect();carouselleft=rect.left;carouselright=rect.right;carouseltop=rect.top;carouselbottom=rect.bottom;carouselwidth=rect.width;carouselheight=rect.height;carouselscroll.parentNode.style.width=carouselwidth+'px';carouselscroll.parentNode.style.height=carouselheight+'px';carouselscroll.childNodes.forEach(function(node,i){if(node.nodeType!==1){carouselscroll.removeChild(node);}});if(!is_filled()){eligible=false;return false;}
slidercount=carouselscroll.children.length;slidercountinview=get_slider_count_in_view();if(step==='auto')
step=slidercountinview;else
step=Math.min(step,slidercountinview);enable_page_button(nextbutton);carouselscroll.setAttribute('data-translate',0);var positionoffset=0;if(loop&currentindex===0){var origin_sliders=carouselscroll.cloneNode(true).children;for(var i=0;i<=slidercountinview;i++){var clone=origin_sliders[i].cloneNode(true);carouselscroll.appendChild(clone);}
for(var i=slidercount-1;i>=slidercount-step;i--){var slider=origin_sliders[i];var clone=slider.cloneNode(true);carouselscroll.insertBefore(clone,carouselscroll.children[0]);}
var positionoffset=get_offset(step);if(direction==='x'){carouselscroll.style.left=-positionoffset+'px';}else{carouselscroll.style.top=-positionoffset+'px';}
currentindex=step;enable_page_button(previousbutton);}
var min=loop?step:0;var max=loop?slidercountinview+step:slidercountinview;var order=1;carouselscroll.childNodes.forEach(function(node,i){if(node.nodeType===1){node.style.width=node.offsetWidth+'px';node.style.height=node.offsetHeight+'px';}
if(i>=min&&i<max){node.classList.add(carouselscrollactiveclass);node.setAttribute('data-order',order);order++;}});var lastsliderrect=carouselscroll.lastElementChild.getBoundingClientRect();if(direction==='x'){scrollwidth=lastsliderrect.right-carouselleft+positionoffset;scrollheight=carouselheight;}else{scrollwidth=carouselwidth;scrollheight=lastsliderrect.bottom-carouseltop+positionoffset;}
carouselscroll.style.width=scrollwidth+'px';carouselscroll.style.height=scrollheight+'px';if(indicator){var count=Math.ceil(slidercount/step);indicator.innerHTML='<span></span>'.repeat(count);carousel_indicator(currentindex);}};function slide(index){if(in_transition){return false;}
in_transition=true;if(loop){if(currentindex<step&&index<currentindex){move(currentindex+slidercount,0);index=index+slidercount;}
else if(index>currentindex&&currentindex+step-1>slidercount+step-1){move(currentindex-slidercount,0);index=index-slidercount;}}
else{if(index<0)
index=0;else if(index>=slidercount-step)
index=slidercount-step;}
if(indicator)
carousel_indicator(index);move(index,duration);setTimeout(function(){if(!loop&&currentindex>=slidercount-step){disable_page_button(nextbutton);}
else if(!loop&&currentindex==0){disable_page_button(previousbutton);}
else if(!loop){enable_page_button(nextbutton);enable_page_button(previousbutton);}
var order=1;carouselscroll.childNodes.forEach(function(c,i){if(i>=index&&i<index+slidercountinview){c.classList.add(carouselscrollactiveclass);c.setAttribute('data-order',order);order++;}else{c.classList.remove(carouselscrollactiveclass);c.removeAttribute('data-order');}});in_transition=false;},duration);}
function carousel_indicator(index){var indicators=indicator.querySelectorAll('span');var indicatorcount=indicators.length;var remainder=slidercount%step;if(loop){if(index<step)
index=index+slidercount-step;else if(index>slidercount+step)
index=index-slidercount+step;else
index=index-step;index=Math.ceil(index/step)%indicatorcount;}else{index=Math.ceil(index/step);}
indicator.querySelectorAll('span').forEach(function(c,i){if(i==index)
c.classList.add(activeclass);else
c.classList.remove(activeclass);});}
function enable_page_button(button){if((button=='next'||button==nextbutton)&&nextbutton){nextbutton.setAttribute('aria-disabled','false');}
else if((button=='previous'||button==previousbutton)&&previousbutton){previousbutton.setAttribute('aria-disabled','false');}}
function disable_page_button(button){if((button=='next'||button==nextbutton)&&nextbutton){nextbutton.setAttribute('aria-disabled','true');}
else if((button=='previous'||button==previousbutton)&&previousbutton){previousbutton.setAttribute('aria-disabled','true');}}
function disabled(){return in_transition&&eligible;}
this.autoplay=function(delay){autoplayid=setInterval(function(){slide(currentindex+step);},delay);}
this.stop=function(){clearInterval(autoplayid);}
if(nextbutton){nextbutton.setAttribute('aria-disabled','true');nextbutton.addEventListener('click',function(e){_this.stop();if(disabled()||nextbutton.getAttribute('aria-disabled')=='true')return false;slide(currentindex+step);});}
if(previousbutton){previousbutton.setAttribute('aria-disabled','true');previousbutton.addEventListener('click',function(e){_this.stop();if(disabled()||previousbutton.getAttribute('aria-disabled')=='true')return false;slide(currentindex-step);});}
if(indicator){indicator.addEventListener('click',function(e){_this.stop();var target=e.target||window.event.srcElement;if(disabled()||target.nodeName!='SPAN')return false;var index=(Array.from(indicator.children).indexOf(target));if(loop){index=index*step+step;}else{index=index*step;}
slide(index);});}
var initpageX=0;var initpageY=0;var pageX=0;var pageY=0;carouselscroll.addEventListener('touchstart',function(ev){_this.stop();initpageX=ev.targetTouches[0].pageX;initpageY=ev.targetTouches[0].pageY;pageX=initpageX;pageY=initpageY;});carouselscroll.addEventListener('touchmove',function(ev){var x=ev.targetTouches[0].pageX;var y=ev.targetTouches[0].pageY;var translate=parseFloat(carouselscroll.getAttribute('data-translate'));carouselscroll.style.transitionDuration='0s';if(direction=='x'){var movedis=x-pageX;var transdis=translate+movedis;carouselscroll.style.transform='translateX('+transdis+'px)';carouselscroll.setAttribute('data-translate',transdis);}else{var movedis=y-pageY;var transdis=translate+movedis;carouselscroll.style.transform='translateY('+transdis+'px)';carouselscroll.setAttribute('data-translate',transdis);}
pageX=x;pageY=y;});carouselscroll.addEventListener('touchend',function(ev){var x=ev.changedTouches[0].pageX;var y=ev.changedTouches[0].pageY;var basedis=get_offset(step)-get_offset(0);if(direction=='x'){var movedis=x-initpageX;}else{var movedis=y-initpageY;}
if(movedis<-basedis/2)
slide(currentindex+step);else if(movedis>basedis/2)
slide(currentindex-step);else
slide(currentindex);});if(mousewheel){var sliderslength=carouselscroll.children.length;carouselscroll.addEventListener('wheel',function(ev){_this.stop();if(event.deltaY>0){if(!loop&&currentindex==sliderslength-1&&!disabled())return false;if(!disabled()){slide(currentindex+step);}}else if(event.deltaY<0){if(!loop&&currentindex==0&&!disabled())return false;if(!disabled()){slide(currentindex-step);}}
ev.preventDefault();ev.stopPropagation();});}
if(readyState==="complete"){__init();}else{w.addEventListener("load",__init);}}
var nestedstyle=w.document.createElement('style');nestedstyle.setAttribute('carousel-extension',version);nestedstyle.innerHTML='.carousel-container{position:relative}.carousel-wrap{position:relative;max-width:100%;max-height:100%;overflow:hidden}.carousel-scroll{position:absolute;display:block;width:100%;height:auto;transition-property:transform;transition-timing-function:ease-in-out}.carousel-scroll>*{box-sizing:border-box}.carousel-scroll-x{white-space:nowrap}.carousel-scroll-x>*{display:inline-block}.carousel-scroll-y>*{display:block}.carousel-previousbutton[aria-disabled=true],.carousel-nextbutton[aria-disabled=true]{display: none}';w.document.head.append(nestedstyle);})(window);
